<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>MySQL二进制日志 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="MySQL二进制日志">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL二进制日志">
<meta property="og:url" content="http://example.com/2023/05/11/MySQL%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="MySQL二进制日志">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-05-11T14:58:51.000Z">
<meta property="article:modified_time" content="2023-05-24T04:34:46.371Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="MariaDB">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-MySQL二进制日志" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/11/MySQL%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97/" class="article-date">
  <time class="dt-published" datetime="2023-05-11T14:58:51.000Z" itemprop="datePublished">2023-05-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/MySQL/">MySQL</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      MySQL二进制日志
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="二进制日志（归档日志，还原数据库使用）"><a href="#二进制日志（归档日志，还原数据库使用）" class="headerlink" title="二进制日志（归档日志，还原数据库使用）"></a>二进制日志（归档日志，还原数据库使用）</h3><blockquote>
<p>记录导致数据改变或潜在导致数据改变的SQL语句</p>
<p>记录已提交的日志</p>
<p>不依赖于存储引擎类型</p>
<p>功能：通过重放日志文件中的事件来生成数据副本</p>
<p>注意：建议二进制日志与数据文件分开存放</p>
</blockquote>
<h4 id="三种日志格式"><a href="#三种日志格式" class="headerlink" title="三种日志格式"></a>三种日志格式</h4><ul>
<li>基于‘语句’记录：statement，记录语句，日志量较少。（MariaDB 10.2.3版以下默认）</li>
<li>基于‘行’记录：row，记录数据，日志量较大，更加安全，建议使用的格式。（MySQL 8.0默认格式）</li>
<li>混合模式：mixed，让系统自行判定该基于哪种方式进行。（MariaDB 10.2.4及以上默认）</li>
</ul>
<p>查看数据库使用的格式：</p>
<p>mysql:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">07:40:41(root@localhost) [(none)] show variables like <span class="string">&#x27;binlog_format&#x27;</span>;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| binlog_format | ROW   |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</span><br></pre></td></tr></table></figure>

<p>mariadb:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; show variables like <span class="string">&#x27;binlog_format&#x27;</span>;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| binlog_format | MIXED |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.001 sec)</span><br></pre></td></tr></table></figure>

<h4 id="日志文件构成"><a href="#日志文件构成" class="headerlink" title="日志文件构成"></a>日志文件构成</h4><blockquote>
<p>日志文件：mysql-bin.000001,mysql-bin.000002, 二进制格式</p>
<p>索引文件：mysql-bin.index 文本格式，记录已有的二进制日志文件列表</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-11 ~]<span class="comment"># ll /var/lib/mysql/binlog*</span></span><br><span class="line">-rw-r----- 1 mysql mysql   180 May 10 20:43 /var/lib/mysql/binlog.000001</span><br><span class="line">-rw-r----- 1 mysql mysql   180 May 10 20:52 /var/lib/mysql/binlog.000002</span><br><span class="line">-rw-r----- 1 mysql mysql   180 May 10 20:52 /var/lib/mysql/binlog.000003</span><br><span class="line">-rw-r----- 1 mysql mysql 11866 May 10 21:37 /var/lib/mysql/binlog.000004</span><br><span class="line">-rw-r----- 1 mysql mysql   157 May 11 17:03 /var/lib/mysql/binlog.000005</span><br><span class="line">-rw-r----- 1 mysql mysql    80 May 11 17:03 /var/lib/mysql/binlog.index</span><br></pre></td></tr></table></figure>

<p>查看二进制日志文件列表及大小</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">04:53:48(root@localhost) [(none)] show binary logs;</span><br><span class="line">+---------------+-----------+-----------+</span><br><span class="line">| Log_name      | File_size | Encrypted |</span><br><span class="line">+---------------+-----------+-----------+</span><br><span class="line">| binlog.000001 |       180 | No        |</span><br><span class="line">| binlog.000002 |       180 | No        |</span><br><span class="line">| binlog.000003 |       180 | No        |</span><br><span class="line">| binlog.000004 |     11866 | No        |</span><br><span class="line">| binlog.000005 |       201 | No        |</span><br><span class="line">| binlog.000006 |       180 | No        |</span><br><span class="line">| binlog.000007 |       687 | No        |</span><br><span class="line">+---------------+-----------+-----------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>查看当前正在使用中的二进制日志文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">04:52:09(root@localhost) [(none)] show master status;</span><br><span class="line">+---------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| File          | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+---------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| binlog.000007 |      687 |              |                  |                   |</span><br><span class="line">+---------------+----------+--------------+------------------+-------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>切换二进制日志文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">02:51:29(root@localhost) [(none)] flush logs;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-11 ~]# mysqladmin  flush-binary-log</span><br><span class="line">[root@Rocky8-11 ~]# mysqladmin  flush-logs</span><br></pre></td></tr></table></figure>

<h4 id="二进制日志相关变量"><a href="#二进制日志相关变量" class="headerlink" title="二进制日志相关变量"></a>二进制日志相关变量</h4><blockquote>
<p>sql_log_bin&#x3D;ON|OFF：是否记录二进制日志，默认on,支持动态修改，系统变量，支持set命令修改（在恢复数据库时临时关闭）</p>
<p>log_bin&#x3D;&#x2F;PATH&#x2F;BIN_LOG_FILE：指定文件位置，默认off,表示不启用二进制日志功能</p>
<p>上述两项都开启才可以启用二进制日志</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">08:03:21(root@localhost) [(none)] show variables like <span class="string">&#x27;%log_bin%&#x27;</span>;</span><br><span class="line">+---------------------------------+-----------------------------+</span><br><span class="line">| Variable_name                   | Value                       |</span><br><span class="line">+---------------------------------+-----------------------------+</span><br><span class="line">| log_bin                         | ON                          |          </span><br><span class="line">| log_bin_basename                | /var/lib/mysql/binlog       |</span><br><span class="line">| log_bin_index                   | /var/lib/mysql/binlog.index |</span><br><span class="line">| log_bin_trust_function_creators | OFF                         |</span><br><span class="line">| log_bin_use_v1_row_events       | OFF                         |</span><br><span class="line">| sql_log_bin                     | ON                          |</span><br><span class="line">+---------------------------------+-----------------------------+</span><br><span class="line">6 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">08:02:02(root@localhost) [(none)] show variables like <span class="string">&#x27;%binlog%&#x27;</span>;</span><br><span class="line">+------------------------------------------------+----------------------+</span><br><span class="line">| Variable_name                                  | Value                |</span><br><span class="line">+------------------------------------------------+----------------------+</span><br><span class="line">| binlog_cache_size                              | 32768                |        <span class="comment">## 每次事务中保存日志记录的缓存大小</span></span><br><span class="line">| binlog_checksum                                | CRC32                |</span><br><span class="line">| binlog_direct_non_transactional_updates        | OFF                  |</span><br><span class="line">| binlog_encryption                              | OFF                  |</span><br><span class="line">| binlog_error_action                            | ABORT_SERVER         |</span><br><span class="line">| binlog_expire_logs_auto_purge                  | ON                   |</span><br><span class="line">| binlog_expire_logs_seconds                     | 2592000              |</span><br><span class="line">| binlog_format                                  | ROW                  |        <span class="comment">## 二进制日志记录的格式</span></span><br><span class="line">| binlog_group_commit_sync_delay                 | 0                    |</span><br><span class="line">| binlog_group_commit_sync_no_delay_count        | 0                    |</span><br><span class="line">| binlog_gtid_simple_recovery                    | ON                   |</span><br><span class="line">| binlog_max_flush_queue_time                    | 0                    |</span><br><span class="line">| binlog_order_commits                           | ON                   |</span><br><span class="line">| binlog_rotate_encryption_master_key_at_startup | OFF                  |</span><br><span class="line">| binlog_row_event_max_size                      | 8192                 |</span><br><span class="line">| binlog_row_image                               | FULL                 |</span><br><span class="line">| binlog_row_metadata                            | MINIMAL              |</span><br><span class="line">| binlog_row_value_options                       |                      |</span><br><span class="line">| binlog_rows_query_log_events                   | OFF                  |</span><br><span class="line">| binlog_stmt_cache_size                         | 32768                |</span><br><span class="line">| binlog_transaction_compression                 | OFF                  |</span><br><span class="line">| binlog_transaction_compression_level_zstd      | 3                    |</span><br><span class="line">| binlog_transaction_dependency_history_size     | 25000                |</span><br><span class="line">| binlog_transaction_dependency_tracking         | COMMIT_ORDER         |</span><br><span class="line">| innodb_api_enable_binlog                       | OFF                  |</span><br><span class="line">| log_statements_unsafe_for_binlog               | ON                   |</span><br><span class="line">| max_binlog_cache_size                          | 18446744073709547520 |        <span class="comment">## 限制用于缓存多事务查询的字节大小</span></span><br><span class="line">| max_binlog_size                                | 1073741824           |        <span class="comment">## 单个日志文件的最大体积</span></span><br><span class="line">| max_binlog_stmt_cache_size                     | 18446744073709547520 |</span><br><span class="line">| sync_binlog                                    | 1                    |        <span class="comment">## 设定是否启动即时同步磁盘功能</span></span><br><span class="line">+------------------------------------------------+----------------------+</span><br><span class="line">30 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.02 sec)</span><br></pre></td></tr></table></figure>

<p>二进制日志自动删除的天数，默认0，不自动删除</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">08:11:16(root@localhost) [(none)] show variables like <span class="string">&#x27;expire_logs_days&#x27;</span>;</span><br><span class="line">+------------------+-------+</span><br><span class="line">| Variable_name    | Value |</span><br><span class="line">+------------------+-------+</span><br><span class="line">| expire_logs_days | 0     |       </span><br><span class="line">+------------------+-------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</span><br></pre></td></tr></table></figure>

<h4 id="修改二进制日志路径"><a href="#修改二进制日志路径" class="headerlink" title="修改二进制日志路径"></a>修改二进制日志路径</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-11 ~]# mkdir -p /data/binlog/</span><br><span class="line">[root@Rocky8-11 ~]# chown mysql. /data/binlog/</span><br><span class="line">[root@Rocky8-11 ~]# ll /data</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x 2 mysql mysql 6 May 17 15:25 binlog</span><br><span class="line"></span><br><span class="line">[root@Rocky8-11 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">log_bin=/data/binlog/mysql-bin</span><br><span class="line">## mysql-bin 为二进制日志的文件名头</span><br><span class="line"></span><br><span class="line">[root@Rocky8-11 ~]# systemctl restart mysqld</span><br><span class="line">[root@Rocky8-11 ~]# ll /data/binlog</span><br><span class="line">total 8</span><br><span class="line">-rw-r----- 1 mysql mysql 157 May 17 16:12 mysql-bin.000001</span><br><span class="line">-rw-r----- 1 mysql mysql  30 May 17 16:12 mysql-bin.index</span><br></pre></td></tr></table></figure>

<h4 id="查看二进制日志内容"><a href="#查看二进制日志内容" class="headerlink" title="查看二进制日志内容"></a>查看二进制日志内容</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">04:16:45(root@localhost) [(none)] show binlog events in &#x27;mysql-bin.000001&#x27;;</span><br><span class="line">+------------------+-----+----------------+-----------+-------------+-----------------------------------+</span><br><span class="line">| Log_name         | Pos | Event_type     | Server_id | End_log_pos | Info                              |</span><br><span class="line">+------------------+-----+----------------+-----------+-------------+-----------------------------------+</span><br><span class="line">| mysql-bin.000001 |   4 | Format_desc    |         1 |         126 | Server ver: 8.0.30, Binlog ver: 4 |</span><br><span class="line">| mysql-bin.000001 | 126 | Previous_gtids |         1 |         157 |                                   |</span><br><span class="line">+------------------+-----+----------------+-----------+-------------+-----------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-11 ~]# mysqlbinlog  /data/binlog/mysql-bin.000001 </span><br><span class="line"># The proper term is pseudo_replica_mode, but we use this compatibility alias</span><br><span class="line"># to make the statement usable on server versions 8.0.24 and older.</span><br><span class="line">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/;</span><br><span class="line">/*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/;</span><br><span class="line">DELIMITER /*!*/;</span><br><span class="line"># at 4</span><br><span class="line">#230517 16:12:50 server id 1  end_log_pos 126 CRC32 0x6ac5be4e 	Start: binlog v 4, server v 8.0.30 created 230517 16:12:50 at startup</span><br><span class="line"># Warning: this binlog is either in use or was not closed properly.</span><br><span class="line">ROLLBACK/*!*/;</span><br><span class="line">BINLOG &#x27;</span><br><span class="line">goxkZA8BAAAAegAAAH4AAAABAAQAOC4wLjMwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span><br><span class="line">AAAAAAAAAAAAAAAAAACCjGRkEwANAAgAAAAABAAEAAAAYgAEGggAAAAICAgCAAAACgoKKioAEjQA</span><br><span class="line">CigAAU6+xWo=</span><br><span class="line">&#x27;/*!*/;</span><br><span class="line"># at 126</span><br><span class="line">#230517 16:12:50 server id 1  end_log_pos 157 CRC32 0x3a5441b0 	Previous-GTIDs</span><br><span class="line"># [empty]</span><br><span class="line">SET @@SESSION.GTID_NEXT= &#x27;AUTOMATIC&#x27; /* added by mysqlbinlog */ /*!*/;</span><br><span class="line">DELIMITER ;</span><br><span class="line"># End of log file</span><br><span class="line">/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/;</span><br><span class="line">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/;</span><br></pre></td></tr></table></figure>

<h5 id="加-v-选项，可查看到行语句"><a href="#加-v-选项，可查看到行语句" class="headerlink" title="加-v 选项，可查看到行语句"></a>加-v 选项，可查看到行语句</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-11 ~]# mysqlbinlog  /data/binlog/mysql-bin.000001  -v</span><br></pre></td></tr></table></figure>

<h4 id="部分日志导出，可用于恢复部分数据："><a href="#部分日志导出，可用于恢复部分数据：" class="headerlink" title="部分日志导出，可用于恢复部分数据："></a>部分日志导出，可用于恢复部分数据：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-11 ~]# mysqlbinlog  /data/binlog/mysql-bin.000001  --start-position=999  --stop-position=1171  -v</span><br><span class="line"># The proper term is pseudo_replica_mode, but we use this compatibility alias</span><br><span class="line"># to make the statement usable on server versions 8.0.24 and older.</span><br><span class="line">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/;</span><br><span class="line">/*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/;</span><br><span class="line">DELIMITER /*!*/;</span><br><span class="line"># at 157</span><br><span class="line">#230517 16:12:50 server id 1  end_log_pos 126 CRC32 0x6ac5be4e 	Start: binlog v 4, server v 8.0.30 created 230517 16:12:50 at startup</span><br><span class="line"># Warning: this binlog is either in use or was not closed properly.</span><br><span class="line">ROLLBACK/*!*/;</span><br><span class="line">BINLOG &#x27;</span><br><span class="line">goxkZA8BAAAAegAAAH4AAAABAAQAOC4wLjMwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span><br><span class="line">AAAAAAAAAAAAAAAAAACCjGRkEwANAAgAAAAABAAEAAAAYgAEGggAAAAICAgCAAAACgoKKioAEjQA</span><br><span class="line">CigAAU6+xWo=</span><br><span class="line">&#x27;/*!*/;</span><br><span class="line"># at 999</span><br><span class="line">#230517 16:41:31 server id 1  end_log_pos 1066 CRC32 0x157cc5fd 	Table_map: `hellodb`.`teachers` mapped to number 96</span><br><span class="line"># at 1066</span><br><span class="line">#230517 16:41:31 server id 1  end_log_pos 1140 CRC32 0x57369f8a 	Update_rows: table id 96 flags: STMT_END_F</span><br><span class="line"></span><br><span class="line">BINLOG &#x27;</span><br><span class="line">O5NkZBMBAAAAQwAAACoEAAAAAGAAAAAAAAEAB2hlbGxvZGIACHRlYWNoZXJzAAQCDwH+BCwB9wEI</span><br><span class="line">AQHAAgEh/cV8FQ==</span><br><span class="line">O5NkZB8BAAAASgAAAHQEAAAAAGAAAAAAAAEAAgAE//8ABAAMAExpbiBDaGFveWluZyoBAAQADABM</span><br><span class="line">aW4gQ2hhb3lpbmcoAYqfNlc=</span><br><span class="line">&#x27;/*!*/;</span><br><span class="line">### UPDATE `hellodb`.`teachers`</span><br><span class="line">### WHERE</span><br><span class="line">###   @1=4</span><br><span class="line">###   @2=&#x27;Lin Chaoying&#x27;</span><br><span class="line">###   @3=42</span><br><span class="line">###   @4=1</span><br><span class="line">### SET</span><br><span class="line">###   @1=4</span><br><span class="line">###   @2=&#x27;Lin Chaoying&#x27;</span><br><span class="line">###   @3=40</span><br><span class="line">###   @4=1</span><br><span class="line"># at 1140</span><br><span class="line">#230517 16:41:31 server id 1  end_log_pos 1171 CRC32 0x60c0cb3b 	Xid = 33</span><br><span class="line">COMMIT/*!*/;</span><br><span class="line">SET @@SESSION.GTID_NEXT= &#x27;AUTOMATIC&#x27; /* added by mysqlbinlog */ /*!*/;</span><br><span class="line">DELIMITER ;</span><br><span class="line"># End of log file</span><br><span class="line">/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/;</span><br><span class="line">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@Rocky8-11 ~]# mysqlbinlog  /data/binlog/mysql-bin.000001  --start-position=999  --stop-position=1171  &gt; binlog.log </span><br><span class="line">[root@Rocky8-11 ~]# mysql &lt; binlog.log</span><br></pre></td></tr></table></figure>

<h4 id="持续性同步备份二进制日志到另一台服务器"><a href="#持续性同步备份二进制日志到另一台服务器" class="headerlink" title="持续性同步备份二进制日志到另一台服务器"></a>持续性同步备份二进制日志到另一台服务器</h4><p>1、建立同步用户、授权</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">05:03:10(root@localhost) [(none)] create user backbinlog@&#x27;10.0.0.%&#x27; identified by &#x27;123456&#x27;;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">05:04:06(root@localhost) [(none)] grant all on *.* to backbinlog@&#x27;10.0.0.%&#x27;;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">05:04:25(root@localhost) [(none)] show master logs;</span><br><span class="line">+------------------+-----------+-----------+</span><br><span class="line">| Log_name         | File_size | Encrypted |</span><br><span class="line">+------------------+-----------+-----------+</span><br><span class="line">| mysql-bin.000001 |      2375 | No        |</span><br><span class="line">+------------------+-----------+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>2、同步（备份服务器）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-13 ~]# mysqlbinlog -R --host=10.0.0.11 --user=backbinlog --password=123456 --raw --stop-never mysql-bin.000001</span><br><span class="line">mysqlbinlog: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="删除二进制日志（可删除时间比较久的无用日志）"><a href="#删除二进制日志（可删除时间比较久的无用日志）" class="headerlink" title="删除二进制日志（可删除时间比较久的无用日志）"></a>删除二进制日志（可删除时间比较久的无用日志）</h4><p>从 mysql-bin.000002 开始保留，mysql-bin.000002 以前的删除：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">05:18:41(root@localhost) [(none)] purge master logs to &#x27;mysql-bin.000002&#x27;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">[root@Rocky8-11 ~]# ll /data/binlog/</span><br><span class="line">total 8</span><br><span class="line">-rw-r----- 1 mysql mysql 495 May 17 17:17 mysql-bin.000002</span><br><span class="line">-rw-r----- 1 mysql mysql  30 May 17 17:21 mysql-bin.index</span><br></pre></td></tr></table></figure>

<h4 id="清空所有日志（重新生成第000001号日志文件）"><a href="#清空所有日志（重新生成第000001号日志文件）" class="headerlink" title="清空所有日志（重新生成第000001号日志文件）"></a>清空所有日志（重新生成第000001号日志文件）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">05:21:34(root@localhost) [(none)] reset master;</span><br><span class="line">Query OK, 0 rows affected (0.04 sec)</span><br><span class="line"></span><br><span class="line">[root@Rocky8-11 ~]# ll /data/binlog/</span><br><span class="line">total 8</span><br><span class="line">-rw-r----- 1 mysql mysql 157 May 17 17:24 mysql-bin.000001</span><br><span class="line">-rw-r----- 1 mysql mysql  30 May 17 17:24 mysql-bin.index</span><br></pre></td></tr></table></figure>

<h4 id="mariadb-10-3-开启二进制日志"><a href="#mariadb-10-3-开启二进制日志" class="headerlink" title="mariadb 10.3 开启二进制日志"></a>mariadb 10.3 开启二进制日志</h4><p>创建存放二进制的目录，更改权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-12 /]# mkdir -p /data/binlog</span><br><span class="line">[root@Rocky8-12 /]# chown mysql. /data/binlog/</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x 2 mysql mysql 53 May 23 14:12 binlog</span><br></pre></td></tr></table></figure>

<p>更改配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-12 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">log_bin = /data/binlog/mysql-bin</span><br></pre></td></tr></table></figure>

<p>重新启动mariadb服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-12 ~]# systemctl restart mariadb.service</span><br><span class="line">[root@Rocky8-12 ~]# ll /data/binlog/</span><br><span class="line">total 12</span><br><span class="line">-rw-rw---- 1 mysql mysql 351 May 23 14:17 mysql-bin.000001</span><br><span class="line">-rw-rw---- 1 mysql mysql 328 May 23 14:17 mysql-bin.000002</span><br><span class="line">-rw-rw---- 1 mysql mysql  60 May 23 14:17 mysql-bin.index</span><br></pre></td></tr></table></figure>

<p>查询binlog状态(sql_log_bin、log_bin)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; show variables like &#x27;%log_bin%&#x27;;</span><br><span class="line">+---------------------------------+------------------------------+</span><br><span class="line">| Variable_name                   | Value                        |</span><br><span class="line">+---------------------------------+------------------------------+</span><br><span class="line">| log_bin                         | ON                           |</span><br><span class="line">| log_bin_basename                | /data/binlog/mysql-bin       |</span><br><span class="line">| log_bin_compress                | OFF                          |</span><br><span class="line">| log_bin_compress_min_len        | 256                          |</span><br><span class="line">| log_bin_index                   | /data/binlog/mysql-bin.index |</span><br><span class="line">| log_bin_trust_function_creators | OFF                          |</span><br><span class="line">| sql_log_bin                     | ON                           |</span><br><span class="line">+---------------------------------+------------------------------+</span><br><span class="line">7 rows in set (0.002 sec)</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/05/11/MySQL%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97/" data-id="clvujh4d9000eo0h9hrrog8pr" data-title="MySQL二进制日志" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MariaDB/" rel="tag">MariaDB</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2023/05/17/MySQL%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          MySQL备份与恢复
        
      </div>
    </a>
  
  
    <a href="/2023/05/11/MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">MySQL基础知识</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux%E5%9F%BA%E7%A1%80/">Linux基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MarkDown/">MarkDown</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PostgreSQL/">PostgreSQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8D%8E%E4%B8%BA%E6%95%B0%E9%80%9A/">华为数通</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%89%E5%85%A8/">安全</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/conf/" rel="tag">.conf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Backup/" rel="tag">Backup</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cluster/" rel="tag">Cluster</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MariaDB/" rel="tag">MariaDB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MarkDown/" rel="tag">MarkDown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mycat/" rel="tag">Mycat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MysqlDump/" rel="tag">MysqlDump</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/" rel="tag">Nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenVPN/" rel="tag">OpenVPN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PXC/" rel="tag">PXC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PostgreSQL/" rel="tag">PostgreSQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RockyLinux/" rel="tag">RockyLinux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Typora/" rel="tag">Typora</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ubuntu/" rel="tag">Ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XtraBackup/" rel="tag">XtraBackup</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/init/" rel="tag">init</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pg-dump/" rel="tag">pg_dump</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/" rel="tag">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%8E%E4%B8%BA%E6%95%B0%E9%80%9A/" rel="tag">华为数通</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" rel="tag">正则表达式</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/conf/" style="font-size: 10px;">.conf</a> <a href="/tags/Backup/" style="font-size: 12.86px;">Backup</a> <a href="/tags/Cluster/" style="font-size: 12.86px;">Cluster</a> <a href="/tags/Linux/" style="font-size: 15.71px;">Linux</a> <a href="/tags/MariaDB/" style="font-size: 20px;">MariaDB</a> <a href="/tags/MarkDown/" style="font-size: 10px;">MarkDown</a> <a href="/tags/MySQL/" style="font-size: 18.57px;">MySQL</a> <a href="/tags/Mycat/" style="font-size: 10px;">Mycat</a> <a href="/tags/MysqlDump/" style="font-size: 10px;">MysqlDump</a> <a href="/tags/Nginx/" style="font-size: 10px;">Nginx</a> <a href="/tags/OpenVPN/" style="font-size: 10px;">OpenVPN</a> <a href="/tags/PXC/" style="font-size: 10px;">PXC</a> <a href="/tags/PostgreSQL/" style="font-size: 14.29px;">PostgreSQL</a> <a href="/tags/RockyLinux/" style="font-size: 10px;">RockyLinux</a> <a href="/tags/Typora/" style="font-size: 10px;">Typora</a> <a href="/tags/Ubuntu/" style="font-size: 10px;">Ubuntu</a> <a href="/tags/XtraBackup/" style="font-size: 10px;">XtraBackup</a> <a href="/tags/init/" style="font-size: 17.14px;">init</a> <a href="/tags/pg-dump/" style="font-size: 11.43px;">pg_dump</a> <a href="/tags/shell/" style="font-size: 11.43px;">shell</a> <a href="/tags/%E5%8D%8E%E4%B8%BA%E6%95%B0%E9%80%9A/" style="font-size: 11.43px;">华为数通</a> <a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 10px;">正则表达式</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">November 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/04/29/OpenVPN%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/">OpenVPN安装与配置</a>
          </li>
        
          <li>
            <a href="/2024/04/18/Ubuntu%E5%88%9D%E5%A7%8B%E5%8C%96/">Ubuntu2204初始化</a>
          </li>
        
          <li>
            <a href="/2024/04/18/Rocky9%E5%88%9D%E5%A7%8B%E5%8C%96/">Rocky9初始化</a>
          </li>
        
          <li>
            <a href="/2024/04/18/Nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6nginx-conf/">Nginx配置文件nginx.conf</a>
          </li>
        
          <li>
            <a href="/2024/01/16/PostgreSQL%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/">PostgreSQL日志管理</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>