<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>PostgreSQL体系架构 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="PostgreSQL体系架构">
<meta property="og:type" content="article">
<meta property="og:title" content="PostgreSQL体系架构">
<meta property="og:url" content="http://example.com/2023/07/22/PostgreSQL%E4%BD%93%E7%B3%BB%E6%9E%B6%E6%9E%84/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="PostgreSQL体系架构">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://xcj-typora-img.oss-cn-hangzhou.aliyuncs.com/img/20230907164950.png">
<meta property="og:image" content="https://xcj-typora-img.oss-cn-hangzhou.aliyuncs.com/img/20230901153453.png">
<meta property="article:published_time" content="2023-07-22T08:05:18.000Z">
<meta property="article:modified_time" content="2023-09-19T07:53:45.979Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="PostgreSQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://xcj-typora-img.oss-cn-hangzhou.aliyuncs.com/img/20230907164950.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-PostgreSQL体系架构" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/22/PostgreSQL%E4%BD%93%E7%B3%BB%E6%9E%B6%E6%9E%84/" class="article-date">
  <time class="dt-published" datetime="2023-07-22T08:05:18.000Z" itemprop="datePublished">2023-07-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/PostgreSQL/">PostgreSQL</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      PostgreSQL体系架构
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="PostgreSQL数据组织结构"><a href="#PostgreSQL数据组织结构" class="headerlink" title="PostgreSQL数据组织结构"></a>PostgreSQL数据组织结构</h3><p><img src="https://xcj-typora-img.oss-cn-hangzhou.aliyuncs.com/img/20230907164950.png"></p>
<p>在PostgreSQL数据库系统中，数据的组结结构分为以下五层：</p>
<ul>
<li>实例：一个安装的数据目录$PGDATA,即一个实例</li>
<li>数据库：一个数据库服务下可以管理多个数据库</li>
<li>模式：一个数据库可以创建多个不同的名称空间Schema，用于分隔不同的业务数据</li>
<li>表和索引：一个数据库可以有多个表和索引，PostgreSQL中表的术语称为Relation </li>
<li>行和列：每张表中有很多列和行数据，PostgreSQL中术语为Tuple</li>
</ul>
<h3 id="PostgreSQL是进程架构模型，MySQL是线程架构模型"><a href="#PostgreSQL是进程架构模型，MySQL是线程架构模型" class="headerlink" title="PostgreSQL是进程架构模型，MySQL是线程架构模型"></a>PostgreSQL是进程架构模型，MySQL是线程架构模型</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-2 ~]# pstree -p</span><br><span class="line">systemd(1)─┬─NetworkManager(831)─┬─&#123;NetworkManager&#125;(857)</span><br><span class="line">           │                     └─&#123;NetworkManager&#125;(861)</span><br><span class="line">           ├─VGAuthService(832)</span><br><span class="line">           ├─agetty(907)</span><br><span class="line">           ├─anacron(1326)</span><br><span class="line">           ├─atd(898)</span><br><span class="line">           ├─auditd(805)───&#123;auditd&#125;(806)</span><br><span class="line">           ├─chronyd(847)</span><br><span class="line">           ├─crond(903)</span><br><span class="line">           ├─dbus-daemon(830)</span><br><span class="line">           ├─gssproxy(874)─┬─&#123;gssproxy&#125;(877)</span><br><span class="line">           │               ├─&#123;gssproxy&#125;(878)</span><br><span class="line">           │               ├─&#123;gssproxy&#125;(879)</span><br><span class="line">           │               ├─&#123;gssproxy&#125;(880)</span><br><span class="line">           │               └─&#123;gssproxy&#125;(881)</span><br><span class="line">           ├─irqbalance(835)───&#123;irqbalance&#125;(849)</span><br><span class="line">           ├─polkitd(1293)─┬─&#123;polkitd&#125;(1299)</span><br><span class="line">           │               ├─&#123;polkitd&#125;(1302)</span><br><span class="line">           │               ├─&#123;polkitd&#125;(1303)</span><br><span class="line">           │               ├─&#123;polkitd&#125;(1304)</span><br><span class="line">           │               ├─&#123;polkitd&#125;(1305)</span><br><span class="line">           │               ├─&#123;polkitd&#125;(1306)</span><br><span class="line">           │               └─&#123;polkitd&#125;(1311)</span><br><span class="line">           ├─postgres(855)─┬─postgres(914)</span><br><span class="line">           │               ├─postgres(915)</span><br><span class="line">           │               ├─postgres(920)</span><br><span class="line">           │               ├─postgres(921)</span><br><span class="line">           │               └─postgres(922)</span><br><span class="line">           ├─rpcbind(803)</span><br><span class="line">           ├─rsyslogd(946)─┬─&#123;rsyslogd&#125;(962)</span><br><span class="line">           │               └─&#123;rsyslogd&#125;(964)</span><br><span class="line">           ├─sshd(871)─┬─sshd(1338)───sshd(1350)───bash(1351)───pstree(1484)</span><br><span class="line">           │           └─sshd(1352)───sshd(1369)───sftp-server(1382)</span><br><span class="line">           ├─systemd(1343)───(sd-pam)(1344)</span><br><span class="line">           ├─systemd-journal(676)</span><br><span class="line">           ├─systemd-logind(839)</span><br><span class="line">           ├─systemd-udevd(715)</span><br><span class="line">           ├─tuned(867)─┬─&#123;tuned&#125;(1292)</span><br><span class="line">           │            ├─&#123;tuned&#125;(1307)</span><br><span class="line">           │            ├─&#123;tuned&#125;(1308)</span><br><span class="line">           │            └─&#123;tuned&#125;(1309)</span><br><span class="line">           └─vmtoolsd(833)─┬─&#123;vmtoolsd&#125;(936)</span><br><span class="line">                           ├─&#123;vmtoolsd&#125;(937)</span><br><span class="line">                           └─&#123;vmtoolsd&#125;(950)</span><br></pre></td></tr></table></figure>

<h3 id="PSQL客户端工具"><a href="#PSQL客户端工具" class="headerlink" title="PSQL客户端工具"></a>PSQL客户端工具</h3><p>psql是PostgreSQL中的一个命令行交互式客户端工具，类似于Mysql中的mysql和Oracle中的sqlplus，PostgreSQL图形化客户端工具（pgadmin）</p>
<ul>
<li>可以使用上下键把使用过的命令或SQL语句调出来</li>
<li>连续按两个TAB键，表示把命令补全或给出提示输入</li>
</ul>
<p>命令格式：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">psql -h &lt;hostname/ip&gt;  -p &lt;端口&gt; [数据库名称] -U [用户名称]</span><br><span class="line"></span><br><span class="line">[root@Rocky8-2 ~]# psql -h 10.0.0.12  -p 5432  hellodb  postgres</span><br></pre></td></tr></table></figure>

<p>-h	## 指定要连接的数据库主机或IP地址，默认local socket登录（unix_socket_directories指定）</p>
<p>-p	## 指定连接的数据库端口</p>
<p>这些连接参数也可用环境变量指定，如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export PGDATABASE=testdb</span><br><span class="line">export PGHOST=10.0.0.12</span><br><span class="line">export PGPOFT=5432</span><br><span class="line">export PGUSER=postgres</span><br></pre></td></tr></table></figure>

<h5 id="psql帮助"><a href="#psql帮助" class="headerlink" title="psql帮助"></a>psql帮助</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">postgres=# \help</span><br><span class="line">You are using psql, the command-line interface to PostgreSQL.</span><br><span class="line">Type:  \copyright for distribution terms</span><br><span class="line">       \h for help with SQL commands</span><br><span class="line">       \? for help with psql commands</span><br><span class="line">       \g or terminate with semicolon to execute query</span><br><span class="line">       \q to quit</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">postgres-# </span><span class="language-bash">\?</span></span><br><span class="line">General</span><br><span class="line">  \copyright             show PostgreSQL usage and distribution terms</span><br><span class="line">  \crosstabview [COLUMNS] execute query and display result in crosstab</span><br><span class="line">  \errverbose            show most recent error message at maximum verbosity</span><br><span class="line">  \g [(OPTIONS)] [FILE]  execute query (and send result to file or |pipe);</span><br><span class="line">                         \g with no arguments is equivalent to a semicolon</span><br><span class="line">  \gdesc                 describe result of query, without executing it</span><br><span class="line">  \gexec                 execute query, then execute each value in its result</span><br><span class="line">  \gset [PREFIX]         execute query and store result in psql variables</span><br><span class="line">  \gx [(OPTIONS)] [FILE] as \g, but forces expanded output mode</span><br><span class="line">  \q                     quit psql</span><br><span class="line">  \watch [SEC]           execute query every SEC seconds</span><br><span class="line"></span><br><span class="line">Help</span><br><span class="line">  \? [commands]          show help on backslash commands</span><br><span class="line">  \? options             show help on psql command-line options</span><br><span class="line">  \? variables           show help on special variables</span><br><span class="line">  \h [NAME]              help on syntax of SQL commands, * for all commands</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="PostgreSQL数据库目录介绍"><a href="#PostgreSQL数据库目录介绍" class="headerlink" title="PostgreSQL数据库目录介绍"></a>PostgreSQL数据库目录介绍</h3><p><img src="https://xcj-typora-img.oss-cn-hangzhou.aliyuncs.com/img/20230901153453.png" alt="20230901153453"></p>
<p>数据库数据存放在变量PGDATA指向的目录，安装数据库时需要指定一个合适的目录做为数据目录的根目录，目录的初始化使用initdb来完成。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-2 ~]# ll $PGDATA</span><br><span class="line">total 64</span><br><span class="line">drwx------ 5 postgres postgres    33 Aug  7 14:06 base</span><br><span class="line">drwx------ 2 postgres postgres  4096 Aug 31 16:01 global</span><br><span class="line">drwx------ 2 postgres postgres     6 Aug  7 14:06 pg_commit_ts</span><br><span class="line">drwx------ 2 postgres postgres     6 Aug  7 14:06 pg_dynshmem</span><br><span class="line">-rw------- 1 postgres postgres  4535 Aug  7 14:06 pg_hba.conf</span><br><span class="line">-rw------- 1 postgres postgres  1636 Aug  7 14:06 pg_ident.conf</span><br><span class="line">drwx------ 4 postgres postgres    68 Aug 31 16:05 pg_logical</span><br><span class="line">drwx------ 4 postgres postgres    36 Aug  7 14:06 pg_multixact</span><br><span class="line">drwx------ 2 postgres postgres     6 Aug  7 14:06 pg_notify</span><br><span class="line">drwx------ 2 postgres postgres     6 Aug  7 14:06 pg_replslot</span><br><span class="line">drwx------ 2 postgres postgres     6 Aug  7 14:06 pg_serial</span><br><span class="line">drwx------ 2 postgres postgres     6 Aug  7 14:06 pg_snapshots</span><br><span class="line">drwx------ 2 postgres postgres     6 Aug 31 16:00 pg_stat</span><br><span class="line">drwx------ 2 postgres postgres     6 Aug  7 14:06 pg_stat_tmp</span><br><span class="line">drwx------ 2 postgres postgres    18 Aug  7 14:06 pg_subtrans</span><br><span class="line">drwx------ 2 postgres postgres     6 Aug  7 14:06 pg_tblspc</span><br><span class="line">drwx------ 2 postgres postgres     6 Aug  7 14:06 pg_twophase</span><br><span class="line">-rw------- 1 postgres postgres     3 Aug  7 14:06 PG_VERSION</span><br><span class="line">drwx------ 3 postgres postgres    60 Aug  7 14:06 pg_wal</span><br><span class="line">drwx------ 2 postgres postgres    18 Aug  7 14:06 pg_xact</span><br><span class="line">-rw------- 1 postgres postgres    88 Aug  7 14:06 postgresql.auto.conf</span><br><span class="line">-rw------- 1 postgres postgres 29412 Aug  7 14:06 postgresql.conf</span><br><span class="line">-rw------- 1 postgres postgres    44 Aug 31 16:00 postmaster.opts</span><br><span class="line">-rw------- 1 postgres postgres    76 Aug 31 16:00 postmaster.pid</span><br></pre></td></tr></table></figure>

<h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><p>初始化完成后，PGDATA目录下会生成三个配置文件：</p>
<ul>
<li>postgresql.conf   #  数据库实例的主配置文件，基本所有的配置参数都在此文件中</li>
<li>pg_hba.conf 	  #  认证配置文件，配置允许哪此IP主机访问数据库，认证的方法等信息</li>
<li>pg_ident.conf     #  认证方式ident的用户映射文件。</li>
</ul>
<h5 id="postgresql-conf"><a href="#postgresql-conf" class="headerlink" title="postgresql.conf"></a>postgresql.conf</h5><blockquote>
<p>postgresql.conf 优先级低于 postgresql.auto.conf</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">listen_addresses=‘*’       			 #监听客户端的地址，默认是本地的localhost，需要修改为*或者0.0.0.0</span><br><span class="line">port = 5432              			 #pg端口，默认是5432</span><br><span class="line">max_connections = 2000      		 #最大连接数，默认100</span><br><span class="line">unix_socket_directories    			 #socket文件的位置，默认在/tmp下面</span><br><span class="line">shared_buffers             			 #数据缓存区，建议值1/4--1/2主机内存，和oracle的buffer cache类似</span><br><span class="line">maintenance_work_mem       			 #维护工作内存，用于vacuum , create index, reindex等。建议值(1/4主机内存)/autovacuum_max_workers</span><br><span class="line">max_worker_processes       			 #总worker数</span><br><span class="line">max_parallel_workers_per_gather		 #单条QUERY中，每个node最多允许开启的并行计算wORKER数</span><br><span class="line">wal_level                  			 #wa1级别，版本11+默认是replica</span><br><span class="line">wal_buffers                			 #类似oracle的1og buffer</span><br><span class="line">checkpoint_timeout         			 #checkpoint时间间隔</span><br><span class="line">max_wal_size               			 #控制wa1的最大数量</span><br><span class="line">min_wal_size               			 #控制wa1的最小数量</span><br><span class="line">archive_command            			 #开启归档命令，示例: &#x27;test ! -f /arch/%f &amp;&amp; cp %p /arch/%f&#x27;</span><br><span class="line">autovacuum                 			 #开启自动vacuum</span><br></pre></td></tr></table></figure>

<h5 id="pg-ident-conf"><a href="#pg-ident-conf" class="headerlink" title="pg_ident.conf"></a>pg_ident.conf</h5><blockquote>
<p>用户映身配置文件，结合pg_hba.conf文件，’method‘为‘ident’可以用特定的操作系统用户以指定的数据库用户身份登录数据库</p>
<p>这个文件记录着与操作系统用户匹配的数据库用户，如果某操作系统用户在本文件中没有映射用户，则默认的映射数据据主用户与操作系统用户同名</p>
</blockquote>
<h5 id="pg-hba-conf"><a href="#pg-hba-conf" class="headerlink" title="pg_hba.conf"></a>pg_hba.conf</h5><blockquote>
<p>HBA:host-based authentication，基于主机的认证，实现防火墙功能，可以控制允许哪些IP的机器访问数据库服务器</p>
</blockquote>
<p>pg_hba.conf文件每行由5部分组成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TYPE    DATABASE        USER            ADDRESS                 METHOD</span><br></pre></td></tr></table></figure>

<h4 id="数据文件"><a href="#数据文件" class="headerlink" title="数据文件"></a>数据文件</h4><p>每一个索引和表都是一个单独文件，称为Segment.文件大小可以在initdb时通过选项–with-segsize&#x3D;SEGSIZE指定</p>
<p>物理位置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$PGDATA/BASE/DATABASE_OID/PG_CLASS.RELFILENODE</span><br></pre></td></tr></table></figure>

<h4 id="控制文件"><a href="#控制文件" class="headerlink" title="控制文件"></a>控制文件</h4><p>控制文件存放当前数据库的状态，存放在 $PGDATA&#x2F;global&#x2F;pg_control 下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-2 ~]# pg_controldata $PGDATA</span><br><span class="line">pg_control version number:            1300</span><br><span class="line">Catalog version number:               202209061</span><br><span class="line">Database system identifier:           7264457813843350549</span><br><span class="line">Database cluster state:               in production</span><br><span class="line">pg_control last modified:             Mon 18 Sep 2023 05:05:40 PM CST</span><br><span class="line">Latest checkpoint location:           0/64ED35A8</span><br><span class="line">Latest checkpoint&#x27;s REDO location:    0/64ED3570</span><br><span class="line">Latest checkpoint&#x27;s REDO WAL file:    000000010000000000000064</span><br><span class="line">Latest checkpoint&#x27;s TimeLineID:       1</span><br><span class="line">Latest checkpoint&#x27;s PrevTimeLineID:   1</span><br><span class="line">Latest checkpoint&#x27;s full_page_writes: on</span><br><span class="line">Latest checkpoint&#x27;s NextXID:          0:749</span><br><span class="line">Latest checkpoint&#x27;s NextOID:          24580</span><br><span class="line">Latest checkpoint&#x27;s NextMultiXactId:  1</span><br><span class="line">Latest checkpoint&#x27;s NextMultiOffset:  0</span><br><span class="line">Latest checkpoint&#x27;s oldestXID:        717</span><br><span class="line">Latest checkpoint&#x27;s oldestXID&#x27;s DB:   1</span><br><span class="line">Latest checkpoint&#x27;s oldestActiveXID:  749</span><br><span class="line">Latest checkpoint&#x27;s oldestMultiXid:   1</span><br><span class="line">Latest checkpoint&#x27;s oldestMulti&#x27;s DB: 1</span><br><span class="line">Latest checkpoint&#x27;s oldestCommitTsXid:0</span><br><span class="line">Latest checkpoint&#x27;s newestCommitTsXid:0</span><br><span class="line">Time of latest checkpoint:            Mon 18 Sep 2023 05:05:39 PM CST</span><br><span class="line">Fake LSN counter for unlogged rels:   0/3E8</span><br><span class="line">Minimum recovery ending location:     0/0</span><br><span class="line">Min recovery ending loc&#x27;s timeline:   0</span><br><span class="line">Backup start location:                0/0</span><br><span class="line">Backup end location:                  0/0</span><br><span class="line">End-of-backup record required:        no</span><br><span class="line">wal_level setting:                    replica</span><br><span class="line">wal_log_hints setting:                off</span><br><span class="line">max_connections setting:              100</span><br><span class="line">max_worker_processes setting:         8</span><br><span class="line">max_wal_senders setting:              10</span><br><span class="line">max_prepared_xacts setting:           0</span><br><span class="line">max_locks_per_xact setting:           64</span><br><span class="line">track_commit_timestamp setting:       off</span><br><span class="line">Maximum data alignment:               8</span><br><span class="line">Database block size:                  8192</span><br><span class="line">Blocks per segment of large relation: 131072</span><br><span class="line">WAL block size:                       8192</span><br><span class="line">Bytes per WAL segment:                16777216</span><br><span class="line">Maximum length of identifiers:        64</span><br><span class="line">Maximum columns in an index:          32</span><br><span class="line">Maximum size of a TOAST chunk:        1996</span><br><span class="line">Size of a large-object chunk:         2048</span><br><span class="line">Date/time type storage:               64-bit integers</span><br><span class="line">Float8 argument passing:              by value</span><br><span class="line">Data page checksum version:           0</span><br><span class="line">Mock authentication nonce:            04dab1c27ec1349493a9e5db6327dd88cc59873f0486b64c238c1c1e47d28d69</span><br></pre></td></tr></table></figure>

<h4 id="日志文件"><a href="#日志文件" class="headerlink" title="日志文件"></a>日志文件</h4><ul>
<li><p>运行日志：$PGDATA&#x2F;log 默认不存在，需要开启配置项loggin_collector</p>
</li>
<li><p>在线重做日志：$PGDATA&#x2F;pg_wal</p>
</li>
<li><p>事务提交日志：$PGDATA&#x2F;pg_xact</p>
</li>
<li><p>服务器日志：可以在服务启动时指定 pg_ctl start -l .&#x2F;logfile</p>
</li>
</ul>
<h3 id="开启远程连接"><a href="#开启远程连接" class="headerlink" title="开启远程连接"></a>开启远程连接</h3><p>默认安装完成后，postgresql只监听local,需要添加监听对外提供服务的ip地址</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 修改postgres用户密码</span></span></span><br><span class="line">[root@Rocky8-2 ~]# psql</span><br><span class="line">postgres=# alter user postgres with password &#x27;123456&#x27;;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 修改监听地址和端口</span></span></span><br><span class="line">[root@Rocky8-2 ~]# vim /pgsql/data/postgresql.conf </span><br><span class="line">listen_addresses = &#x27;*&#x27;                  # what IP address(es) to listen on;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">listen_addresses = <span class="string">&#x27;localhost&#x27;</span>         <span class="comment"># what IP address(es) to listen on;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 在pg_hba.conf中添加一行</span></span></span><br><span class="line">host    all             all             0.0.0.0/0               md5</span><br><span class="line"></span><br><span class="line">[root@Rocky8-2 ~]# vim /pgsql/data/pg_hba.conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">IPv4 <span class="built_in">local</span> connections:</span></span><br><span class="line">host    all             all             127.0.0.1/32            md5</span><br><span class="line">host    all             all             0.0.0.0/0               md5</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 重启服务</span></span></span><br><span class="line">[root@Rocky8-2 ~]# su - postgres </span><br><span class="line">[postgres@Rocky8-2 ~]$  pg_ctl restart -mf</span><br><span class="line">waiting for server to shut down.... done</span><br><span class="line">server stopped</span><br><span class="line">waiting for server to start....2023-09-11 17:24:21.580 CST [1611] LOG:  starting PostgreSQL 15.3 on x86_64-pc-linux-gnu, compiled by gcc (GCC) 8.5.0 20210514 (Red Hat 8.5.0-18), 64-bit</span><br><span class="line">2023-09-11 17:24:21.581 CST [1611] LOG:  listening on IPv4 address &quot;0.0.0.0&quot;, port 5432</span><br><span class="line">2023-09-11 17:24:21.581 CST [1611] LOG:  listening on IPv6 address &quot;::&quot;, port 5432</span><br><span class="line">2023-09-11 17:24:21.583 CST [1611] LOG:  listening on Unix socket &quot;/tmp/.s.PGSQL.5432&quot;</span><br><span class="line">2023-09-11 17:24:21.588 CST [1614] LOG:  database system was shut down at 2023-09-11 17:24:21 CST</span><br><span class="line">2023-09-11 17:24:21.592 CST [1611] LOG:  database system is ready to accept connections</span><br><span class="line"> done</span><br><span class="line">server started</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 查看监听端口</span></span></span><br><span class="line">[postgres@Rocky8-2 ~]$ ss -ntl</span><br><span class="line">State              Recv-Q             Send-Q                         Local Address:Port                         Peer Address:Port            Process             </span><br><span class="line">LISTEN             0                  128                                  0.0.0.0:111                               0.0.0.0:*                                   </span><br><span class="line">LISTEN             0                  128                                  0.0.0.0:22                                0.0.0.0:*                                   </span><br><span class="line">LISTEN             0                  244                                  0.0.0.0:5432                              0.0.0.0:*                                   </span><br><span class="line">LISTEN             0                  128                                     [::]:111                                  [::]:*                                   </span><br><span class="line">LISTEN             0                  128                                     [::]:22                                   [::]:*                                   </span><br><span class="line">LISTEN             0                  244                                     [::]:5432                                 [::]:*   </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 在远程机器测试连接</span></span></span><br><span class="line">[root@Rocky8-1 ~]# psql  -h 10.0.0.12 -p 5432 -U postgres</span><br><span class="line">Password for user postgres: </span><br><span class="line">psql (15.3)</span><br><span class="line">Type &quot;help&quot; for help.</span><br><span class="line"></span><br><span class="line">postgres=# </span><br></pre></td></tr></table></figure>

<h3 id="设置显示信息的格式"><a href="#设置显示信息的格式" class="headerlink" title="设置显示信息的格式"></a>设置显示信息的格式</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 调整横向和纵向显示</span></span></span><br><span class="line">postgres=# \x</span><br><span class="line">Expanded display is on.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 显示命令执行的时长</span></span></span><br><span class="line">postgres=# timing on </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 显示详细信息，可打印出报出问题的源代码位置</span></span></span><br><span class="line"><span class="meta prompt_">postgres-# </span><span class="language-bash">\<span class="built_in">set</span> VERBOSITY verbose</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="查看和连接数据库"><a href="#查看和连接数据库" class="headerlink" title="查看和连接数据库"></a>查看和连接数据库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 列出数据库，相当于Mysql的 show databases</span></span></span><br><span class="line">postgres=# \l</span><br><span class="line">                                            List of databases</span><br><span class="line">   Name    |  Owner   | Encoding | Collate | Ctype | ICU Locale | Locale Provider |   Access privileges   </span><br><span class="line">-----------+----------+----------+---------+-------+------------+-----------------+-----------------------</span><br><span class="line"> postgres  | postgres | UTF8     | C       | C     |            | libc            | </span><br><span class="line"> template0 | postgres | UTF8     | C       | C     |            | libc            | =c/postgres          +</span><br><span class="line">           |          |          |         |       |            |                 | postgres=CTc/postgres</span><br><span class="line"> template1 | postgres | UTF8     | C       | C     |            | libc            | =c/postgres          +</span><br><span class="line">           |          |          |         |       |            |                 | postgres=CTc/postgres</span><br><span class="line"> testdb1   | postgres | UTF8     | C       | C     |            | libc            | </span><br><span class="line">(4 rows)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 显示数据为详细信息</span></span></span><br><span class="line">postgres=# \l+</span><br><span class="line">                                                                              List of databases</span><br><span class="line">   Name    |  Owner   | Encoding | Collate | Ctype | ICU Locale | Locale Provider |   Access privileges   |  Size   | Tablespace |                Description    </span><br><span class="line">             </span><br><span class="line">-----------+----------+----------+---------+-------+------------+-----------------+-----------------------+---------+------------+-------------------------------</span><br><span class="line">-------------</span><br><span class="line"> postgres  | postgres | UTF8     | C       | C     |            | libc            |                       | 7229 kB | pg_default | default administrative connect</span><br><span class="line">ion database</span><br><span class="line"> template0 | postgres | UTF8     | C       | C     |            | libc            | =c/postgres          +| 7073 kB | pg_default | unmodifiable empty database</span><br><span class="line">           |          |          |         |       |            |                 | postgres=CTc/postgres |         |            | </span><br><span class="line"> template1 | postgres | UTF8     | C       | C     |            | libc            | =c/postgres          +| 7301 kB | pg_default | default template for new datab</span><br><span class="line">ases</span><br><span class="line">           |          |          |         |       |            |                 | postgres=CTc/postgres |         |            | </span><br><span class="line"> testdb1   | postgres | UTF8     | C       | C     |            | libc            |                       | 7145 kB | pg_default | </span><br><span class="line">(4 rows)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 查看当前连接</span></span></span><br><span class="line">postgres=# \c</span><br><span class="line">You are now connected to database &quot;postgres&quot; as user &quot;postgres&quot;.</span><br><span class="line">postgres=# \conninfo</span><br><span class="line">You are connected to database &quot;postgres&quot; as user &quot;postgres&quot; via socket in &quot;/tmp&quot; at port &quot;5432&quot;.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 使用数据库</span></span></span><br><span class="line">postgres=# \c testdb1</span><br><span class="line">You are now connected to database &quot;testdb1&quot; as user &quot;postgres&quot;.</span><br><span class="line">testdb1=# </span><br></pre></td></tr></table></figure>

<h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 方法1</span></span></span><br><span class="line">postgres=# create database testdb1;</span><br><span class="line">CREATE DATABASE</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 方法2</span></span></span><br><span class="line">[root@Rocky8-2 ~]# createdb  -h 10.0.0.12 -p 5432 -U postgres testdb2</span><br><span class="line">Password: </span><br><span class="line"></span><br><span class="line">postgres=# \l</span><br><span class="line">                                            List of databases</span><br><span class="line">   Name    |  Owner   | Encoding | Collate | Ctype | ICU Locale | Locale Provider |   Access privileges   </span><br><span class="line">-----------+----------+----------+---------+-------+------------+-----------------+-----------------------</span><br><span class="line"> postgres  | postgres | UTF8     | C       | C     |            | libc            | </span><br><span class="line"> template0 | postgres | UTF8     | C       | C     |            | libc            | =c/postgres          +</span><br><span class="line">           |          |          |         |       |            |                 | postgres=CTc/postgres</span><br><span class="line"> template1 | postgres | UTF8     | C       | C     |            | libc            | =c/postgres          +</span><br><span class="line">           |          |          |         |       |            |                 | postgres=CTc/postgres</span><br><span class="line"> testdb1   | postgres | UTF8     | C       | C     |            | libc            | </span><br><span class="line"> testdb2   | postgres | UTF8     | C       | C     |            | libc            | </span><br><span class="line">(5 rows)</span><br></pre></td></tr></table></figure>

<h3 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">postgres=# drop database testdb2;</span><br><span class="line">DROP DATABASE</span><br><span class="line"></span><br><span class="line">postgres=# \l</span><br><span class="line">                                            List of databases</span><br><span class="line">   Name    |  Owner   | Encoding | Collate | Ctype | ICU Locale | Locale Provider |   Access privileges   </span><br><span class="line">-----------+----------+----------+---------+-------+------------+-----------------+-----------------------</span><br><span class="line"> postgres  | postgres | UTF8     | C       | C     |            | libc            | </span><br><span class="line"> template0 | postgres | UTF8     | C       | C     |            | libc            | =c/postgres          +</span><br><span class="line">           |          |          |         |       |            |                 | postgres=CTc/postgres</span><br><span class="line"> template1 | postgres | UTF8     | C       | C     |            | libc            | =c/postgres          +</span><br><span class="line">           |          |          |         |       |            |                 | postgres=CTc/postgres</span><br><span class="line"> testdb1   | postgres | UTF8     | C       | C     |            | libc            | </span><br><span class="line">(4 rows)</span><br></pre></td></tr></table></figure>

<h3 id="创建表和表数据的CRUD操作"><a href="#创建表和表数据的CRUD操作" class="headerlink" title="创建表和表数据的CRUD操作"></a>创建表和表数据的CRUD操作</h3><p>CRUD即：insert  update  delete  select </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">postgres=# \c testdb1 </span><br><span class="line">You are now connected to database &quot;testdb1&quot; as user &quot;postgres&quot;.</span><br><span class="line">testdb1=# create table tb2 (id serial primary key,name text);</span><br><span class="line">CREATE TABLE</span><br><span class="line"></span><br><span class="line">testdb1=# \d tb2;</span><br><span class="line">                            Table &quot;public.tb1&quot;</span><br><span class="line"> Column |  Type   | Collation | Nullable |             Default             </span><br><span class="line">--------+---------+-----------+----------+---------------------------------</span><br><span class="line"> id     | integer |           | not null | nextval(&#x27;tb1_id_seq&#x27;::regclass)</span><br><span class="line"> name   | text    |           |          | </span><br><span class="line">Indexes:</span><br><span class="line">    &quot;tb1_pkey&quot; PRIMARY KEY, btree (id)</span><br><span class="line">    </span><br><span class="line">testdb1=# insert into tb2 (name) values (&#x27;wang&#x27;);</span><br><span class="line"></span><br><span class="line">testdb1=# select * from tb2;</span><br><span class="line"></span><br><span class="line">testdb1=# update tb2 set name=&#x27;zhang&#x27; where id=2;</span><br><span class="line"></span><br><span class="line">testdb1=# delete from tb2 where id=2;</span><br><span class="line"></span><br><span class="line">testdb1=# drop table tb1;</span><br></pre></td></tr></table></figure>

<h3 id="查看数据库用户"><a href="#查看数据库用户" class="headerlink" title="查看数据库用户"></a>查看数据库用户</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">postgres=# \du</span><br><span class="line">                                   List of roles</span><br><span class="line"> Role name |                         Attributes                         | Member of </span><br><span class="line">-----------+------------------------------------------------------------+-----------</span><br><span class="line"> postgres  | Superuser, Create role, Create DB, Replication, Bypass RLS | &#123;&#125;</span><br><span class="line"></span><br><span class="line">postgres=# \dg</span><br><span class="line">                                   List of roles</span><br><span class="line"> Role name |                         Attributes                         | Member of </span><br><span class="line">-----------+------------------------------------------------------------+-----------</span><br><span class="line"> postgres  | Superuser, Create role, Create DB, Replication, Bypass RLS | &#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="事务管理"><a href="#事务管理" class="headerlink" title="事务管理"></a>事务管理</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 开始事务</span></span></span><br><span class="line">  BEGIN </span><br><span class="line"><span class="meta prompt_">testdb1-# </span><span class="language-bash">\h begin</span> </span><br><span class="line">Command:     BEGIN</span><br><span class="line">Description: start a transaction block</span><br><span class="line">Syntax:</span><br><span class="line">BEGIN [ WORK | TRANSACTION ] [ transaction_mode [, ...] ]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 提交事务</span></span></span><br><span class="line">  COMMIT | END</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 取消事务   需要在关闭自动提交状态下：\set AUTOCOMMIT OFF</span></span> </span><br><span class="line">  ROLLBACK</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 查看事务ID</span></span></span><br><span class="line">  select txid_current();</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/07/22/PostgreSQL%E4%BD%93%E7%B3%BB%E6%9E%B6%E6%9E%84/" data-id="clvujh4dj0016o0h9fnll4bil" data-title="PostgreSQL体系架构" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PostgreSQL/" rel="tag">PostgreSQL</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2023/07/31/PostgreSQL%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          PostgreSQL备份恢复
        
      </div>
    </a>
  
  
    <a href="/2023/07/18/PostgreSQL%E5%AE%89%E8%A3%85%E5%88%9D%E5%A7%8B%E5%8C%96/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">PostgreSQL安装初始化</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux%E5%9F%BA%E7%A1%80/">Linux基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MarkDown/">MarkDown</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PostgreSQL/">PostgreSQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8D%8E%E4%B8%BA%E6%95%B0%E9%80%9A/">华为数通</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%89%E5%85%A8/">安全</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/conf/" rel="tag">.conf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Backup/" rel="tag">Backup</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cluster/" rel="tag">Cluster</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MariaDB/" rel="tag">MariaDB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MarkDown/" rel="tag">MarkDown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mycat/" rel="tag">Mycat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MysqlDump/" rel="tag">MysqlDump</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/" rel="tag">Nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenVPN/" rel="tag">OpenVPN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PXC/" rel="tag">PXC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PostgreSQL/" rel="tag">PostgreSQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RockyLinux/" rel="tag">RockyLinux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Typora/" rel="tag">Typora</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ubuntu/" rel="tag">Ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XtraBackup/" rel="tag">XtraBackup</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/init/" rel="tag">init</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pg-dump/" rel="tag">pg_dump</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/" rel="tag">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%8E%E4%B8%BA%E6%95%B0%E9%80%9A/" rel="tag">华为数通</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" rel="tag">正则表达式</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/conf/" style="font-size: 10px;">.conf</a> <a href="/tags/Backup/" style="font-size: 12.86px;">Backup</a> <a href="/tags/Cluster/" style="font-size: 12.86px;">Cluster</a> <a href="/tags/Linux/" style="font-size: 15.71px;">Linux</a> <a href="/tags/MariaDB/" style="font-size: 20px;">MariaDB</a> <a href="/tags/MarkDown/" style="font-size: 10px;">MarkDown</a> <a href="/tags/MySQL/" style="font-size: 18.57px;">MySQL</a> <a href="/tags/Mycat/" style="font-size: 10px;">Mycat</a> <a href="/tags/MysqlDump/" style="font-size: 10px;">MysqlDump</a> <a href="/tags/Nginx/" style="font-size: 10px;">Nginx</a> <a href="/tags/OpenVPN/" style="font-size: 10px;">OpenVPN</a> <a href="/tags/PXC/" style="font-size: 10px;">PXC</a> <a href="/tags/PostgreSQL/" style="font-size: 14.29px;">PostgreSQL</a> <a href="/tags/RockyLinux/" style="font-size: 10px;">RockyLinux</a> <a href="/tags/Typora/" style="font-size: 10px;">Typora</a> <a href="/tags/Ubuntu/" style="font-size: 10px;">Ubuntu</a> <a href="/tags/XtraBackup/" style="font-size: 10px;">XtraBackup</a> <a href="/tags/init/" style="font-size: 17.14px;">init</a> <a href="/tags/pg-dump/" style="font-size: 11.43px;">pg_dump</a> <a href="/tags/shell/" style="font-size: 11.43px;">shell</a> <a href="/tags/%E5%8D%8E%E4%B8%BA%E6%95%B0%E9%80%9A/" style="font-size: 11.43px;">华为数通</a> <a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 10px;">正则表达式</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">November 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/04/29/OpenVPN%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/">OpenVPN安装与配置</a>
          </li>
        
          <li>
            <a href="/2024/04/18/Ubuntu%E5%88%9D%E5%A7%8B%E5%8C%96/">Ubuntu2204初始化</a>
          </li>
        
          <li>
            <a href="/2024/04/18/Rocky9%E5%88%9D%E5%A7%8B%E5%8C%96/">Rocky9初始化</a>
          </li>
        
          <li>
            <a href="/2024/04/18/Nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6nginx-conf/">Nginx配置文件nginx.conf</a>
          </li>
        
          <li>
            <a href="/2024/01/16/PostgreSQL%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/">PostgreSQL日志管理</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>